<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${trainingTitle}"></title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
	
	<script th:src="@{/js/theme.js}"></script>
    <style>
        .session-page .main-container { max-width: 650px; padding: 30px; }
        .program-card {
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            background: #2a2a2a;
            box-shadow: 0 0 15px rgba(0, 230, 118, 0.4);
            text-align: center;
        }
        .program-card h2 { color: var(--primary-color); font-size: 28px; margin-top: 0; }
        .program-card p.exercise-type {
            color: #ccc;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .program-list { list-style: none; padding: 0; text-align: left; }
        .program-list li { 
            padding: 10px 0; 
            border-bottom: 1px dashed #444; 
            color: #ddd; 
            font-weight: 500;
        }
        .control-buttons { margin-top: 40px; display: flex; flex-direction: column; gap: 15px; }
        .control-buttons a, .control-buttons button { flex-grow: 1; }
        
        .log-placeholder {
            background-color: #1e1e1e;
            border: 1px dashed #555;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            color: #888;
        }
        
        /* === TIMER STYLES === */
        .timer-section {
            background-color: #1a1a1a;
            padding: 25px;
            border-radius: 10px;
            margin-top: 30px;
            border: 1px solid #333;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
        }
        .timer-display {
            font-size: 48px;
            font-weight: 800;
            letter-spacing: 3px;
            color: #fff;
            margin: 10px 0 20px;
            font-family: 'Poppins', monospace;
        }
        .timer-interval {
            color: var(--primary-color);
        }
        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .timer-controls button {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            border: none;
            flex-grow: 1;
        }
        .timer-button-primary {
            background-color: var(--primary-color);
            color: #1a1a1a;
        }
        .timer-button-secondary {
            background-color: #444;
            color: #ddd;
        }
        .timer-button-tertiary {
            background-color: #555;
            color: #fff;
            font-size: 14px;
            padding: 8px 15px;
        }
        .timer-controls button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
        }
        .timer-settings {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin-bottom: 15px;
            color: #ddd;
        }
        .timer-settings input {
            background-color: #333;
            color: #fff;
            border: 1px solid #555;
            border-radius: 5px;
            padding: 5px;
            text-align: center;
            font-size: 16px;
        }

        /* === RECORD FORM STYLES === */
        .record-form-container {
            background-color: #1e1e1e;
            padding: 25px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: left;
        }
        .form-label {
            display: block;
            color: #aaa;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-group {
            flex: 1;
        }
        .form-input {
            width: 100%;
            padding: 12px;
            background-color: #333;
            border: 1px solid #555;
            border-radius: 8px;
            color: white;
            font-size: 1.1rem;
            text-align: center;
        }
        .form-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }
        .unit {
            color: #888;
            font-size: 0.8rem;
            text-align: center;
            display: block;
            margin-top: 3px;
        }
        .btn-finish {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: #1a1a1a;
            font-weight: 800;
            font-size: 1.1rem;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s;
            display: block;
            text-decoration: none;
            text-align: center;
            margin-top: 20px;
        }
        .btn-finish:hover {
            transform: scale(1.02);
            background-color: #00c853;
        }
    </style>
</head>
<body class="session-page">
<div class="main-container">
    <h1 th:text="${trainingTitle}"><i class="fa-solid fa-bolt-lightning header-icon"></i>„Çª„ÉÉ„Ç∑„Éß„É≥ÈñãÂßã</h1>

    <div class="program-card">
        <h2 th:text="${selectedExercise}">Á®ÆÁõÆÂêç</h2>

        <p class="exercise-type" th:if="${trainingType == 'free-weight'}"><i class="fa-solid fa-weight-hanging"></i> „Éï„É™„Éº„Ç¶„Çß„Ç§„Éà</p>
        <p class="exercise-type" th:if="${trainingType == 'cardio'}"><i class="fa-solid fa-running"></i> ÊúâÈÖ∏Á¥†ÈÅãÂãï</p>
        <p class="exercise-type" th:if="${trainingType == 'ai-suggested'}"><i class="fa-solid fa-star"></i> AI„Åä„Åô„Åô„ÇÅ„Éó„É≠„Ç∞„É©„É†</p>
        
        <div class="interval-container">
            <h3 style="color: var(--primary-color); margin-bottom: 5px; margin-top: 20px;">„Ç§„É≥„Çø„Éº„Éê„É´„Çø„Ç§„Éû„Éº</h3>
            <div id="interval-display" class="timer-display timer-interval">01:00</div>
            <div class="timer-settings">
                <input type="number" id="interval-minutes" value="1" min="0" max="59" style="width: 50px;"> ÂàÜ
                <input type="number" id="interval-seconds" value="0" min="0" max="59" style="width: 50px;"> Áßí
                <button id="interval-set" class="button timer-button-tertiary"><i class="fa-solid fa-clock"></i> Ë®≠ÂÆö</button>
            </div>
            <div class="timer-controls">
                <button id="interval-start-pause" class="button timer-button-primary"><i class="fa-solid fa-play"></i> ÈñãÂßã</button>
                <button id="interval-reset" class="button timer-button-secondary"><i class="fa-solid fa-rotate-left"></i> „É™„Çª„ÉÉ„Éà</button>
            </div>
        </div>
    </div>

    <div th:if="${trainingType == 'free-weight'}" class="record-form-container">
        <h3 style="color:white; margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
            <i class="fa-solid fa-pen-to-square"></i> ÂÆüÁ∏æ„ÇíË®òÈå≤
        </h3>
        <form th:action="@{/training-log/save}" method="post" id="weight-form">
            <input type="hidden" name="recordDate" th:value="${today}">
            <input type="hidden" name="type" value="WEIGHT">
            <input type="hidden" name="exerciseName" th:value="${selectedExercise}">
            
            <table style="width: 100%; color: white; border-collapse: separate; border-spacing: 0 10px;">
                <thead>
                    <tr style="color: #aaa; font-size: 0.9em;">
                        <th style="text-align: center; width: 15%;">Set</th>
                        <th style="text-align: center; width: 40%;">ÈáçÈáè (kg)</th>
                        <th style="text-align: center; width: 40%;">ÂõûÊï∞ (Reps)</th>
                        <th style="width: 5%;"></th>
                    </tr>
                </thead>
                <tbody id="sets-container">
                    </tbody>
            </table>

            <button type="button" id="add-set-btn" class="button secondary" style="width: 100%; margin-top: 10px; padding: 10px; font-size: 0.9em;">
                <i class="fa-solid fa-plus"></i> „Çª„ÉÉ„Éà„ÇíËøΩÂä†
            </button>
            
            <button type="submit" class="btn-finish" style="margin-top: 20px;">
                Ë®òÈå≤„Åó„Å¶ÁµÇ‰∫Ü <i class="fa-solid fa-check"></i>
            </button>
        </form>
    </div>

    <div th:if="${trainingType == 'cardio'}" class="record-form-container">
        <h3 style="color:white; margin-bottom:15px; border-bottom:1px solid #444; padding-bottom:10px;">
            <i class="fa-solid fa-pen-to-square"></i> ÂÆüÁ∏æ„ÇíË®òÈå≤
        </h3>
        <form th:action="@{/training-log/save}" method="post">
            <input type="hidden" name="recordDate" th:value="${today}">
            <input type="hidden" name="type" value="CARDIO">
            <input type="hidden" name="cardioType" th:value="${selectedExercise}">
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">ÊôÇÈñì</label>
                    <input type="number" name="durationMinutes" class="form-input" placeholder="0" required>
                    <span class="unit">ÂàÜ (Minutes)</span>
                </div>
                <div class="form-group">
                    <label class="form-label">Ë∑ùÈõ¢</label>
                    <input type="number" name="distanceKm" class="form-input" step="0.1" placeholder="0.0">
                    <span class="unit">km (‰ªªÊÑè)</span>
                </div>
            </div>
            
            <button type="submit" class="btn-finish">
                Ë®òÈå≤„Åó„Å¶ÁµÇ‰∫Ü <i class="fa-solid fa-check"></i>
            </button>
        </form>
    </div>

    <div th:if="${trainingType == 'ai-suggested'}">
         <div class="log-placeholder" style="border-color: var(--ai-accent-color); box-shadow: 0 0 15px rgba(0, 255, 255, 0.4);">
            <p style="color: var(--ai-accent-color); font-weight: 600;">FitBot„ÅÆÊèêÊ°àÂÜÖÂÆπ:</p>
            <ul class="program-list">
                <li th:each="program : ${programList}">
                    <i class="fa-solid fa-circle-right" style="color:#00c8c8;"></i> 
                    <span th:text="${program}">1. Á®ÆÁõÆA: 4„Çª„ÉÉ„Éà x 10Âõû (70kg) (AI„Éó„É≠„Ç∞„É©„É†„ÅÆ‰æã)</span>
                </li>
            </ul>
            <p style="margin-top: 20px; color: var(--primary-color);">
                ÁõÆÊ®ôÊôÇÈñì: <span th:text="${targetTime}">45</span>ÂàÜ / ‰ºëÊÜ©ÊôÇÈñì: <span th:text="${restTime}">60</span>Áßí
            </p>
        </div>
        <div class="control-buttons">
             <a th:href="@{/training-log}" class="button primary">„Çª„ÉÉ„Ç∑„Éß„É≥ÂÆå‰∫Ü („Ç´„É¨„É≥„ÉÄ„Éº„Å´Êàª„Çã)</a>
        </div>
    </div>
</div>

<div class="button-container" style="margin-top: 20px;">
    <a th:href="@{/ai-coach}" class="button primary">
        „Éà„É¨„Éº„Éã„É≥„Ç∞ÂÜÖÂÆπ„ÇíAI„Ç≥„Éº„ÉÅ„Å´Áõ∏Ë´á ü§ñ
    </a>
</div>
    
<div class="control-buttons" style="margin-top: -5px;">
    <a th:href="@{/training}" class="button secondary">
        <i class="fa-solid fa-arrow-rotate-left"></i> ‰∏≠Êñ≠„Åó„Å¶„É°„Éã„É•„ÉºÈÅ∏Êäû„Å´Êàª„Çã
    </a>
</div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Utility function for formatting time (Minutes:Seconds) ---
        const formatTime = (ms) => {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            const pad = (num) => String(num).padStart(2, '0');
            return `${pad(minutes)}:${pad(seconds)}`;
        };

        // =======================================================
        // „Çª„ÉÉ„ÉàËøΩÂä†Ê©üËÉΩ (Êñ∞Ë¶èËøΩÂä†)
        // =======================================================
        const setsContainer = document.getElementById('sets-container');
        const addSetBtn = document.getElementById('add-set-btn');
        
        if (setsContainer && addSetBtn) {
            let setCounter = 0;

            const addSetRow = (weight = '', reps = '') => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="text-align: center; font-weight: bold; vertical-align: middle;">${setCounter + 1}</td>
                    <td style="padding: 0 5px;">
                        <input type="number" name="setList[${setCounter}].weight" class="form-input" step="0.5" placeholder="kg" value="${weight}" required style="text-align: center;">
                    </td>
                    <td style="padding: 0 5px;">
                        <input type="number" name="setList[${setCounter}].reps" class="form-input" placeholder="Âõû" value="${reps}" required style="text-align: center;">
                    </td>
                    <td style="text-align: center; vertical-align: middle;">
                         <i class="fa-solid fa-trash" onclick="removeRow(this)" style="color: #666; cursor: pointer;"></i>
                    </td>
                `;
                setsContainer.appendChild(tr);
                setCounter++;
            };

            // Ë°åÂâäÈô§Ê©üËÉΩ
            window.removeRow = function(icon) {
                const row = icon.closest('tr');
                row.remove();
                // ‚ÄªÊ≥®ÊÑè: „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíË©∞„ÇÅÁõ¥„ÅôÂá¶ÁêÜ„ÅåÂøÖË¶Å„Å™Â†¥Âêà„Åå„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅ
                // Spring Boot„ÅØÈ£õ„Å≥È£õ„Å≥„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ(setList[0], setList[2]...)„Åß„ÇÇ„Éê„Ç§„É≥„ÉâÂèØËÉΩ„Å™„Åü„ÇÅ
                // Á∞°ÊòìÂÆüË£Ö„Å®„Åó„Å¶„Åù„ÅÆ„Åæ„Åæ„Å´„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ
            };

            // ÂàùÊúüÁä∂ÊÖã„Åß3„Çª„ÉÉ„ÉàÂàÜË°®Á§∫
            addSetRow();
            addSetRow();
            addSetRow();

            addSetBtn.addEventListener('click', () => {
                addSetRow();
            });
        }

        // =======================================================
        // 2. „Ç§„É≥„Çø„Éº„Éê„É´„Çø„Ç§„Éû„ÉºÊ©üËÉΩ (Interval Timer)
        // =======================================================
        const ivDisplay = document.getElementById('interval-display');
        const ivMinInput = document.getElementById('interval-minutes');
        const ivSecInput = document.getElementById('interval-seconds');
        const ivSetBtn = document.getElementById('interval-set');
        const ivStartPauseBtn = document.getElementById('interval-start-pause');
        const ivResetBtn = document.getElementById('interval-reset');

        let ivInitialTime = 60000; // ÂàùÊúüÂÄ§: 1ÂàÜ
        let ivRemainingTime = ivInitialTime;
        let ivTimer = null;
        let isIvRunning = false;

        const updateIvDisplay = () => {
            if(!ivDisplay) return;
            ivDisplay.textContent = formatTime(ivRemainingTime);

            if (ivRemainingTime <= 10000 && ivRemainingTime > 0) {
                 ivDisplay.style.color = '#ff0000'; 
            } else {
                 ivDisplay.style.color = 'var(--primary-color)';
            }
        };

        const handleIvFinish = () => {
            clearInterval(ivTimer);
            isIvRunning = false;
            ivStartPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> ÈñãÂßã';
            ivStartPauseBtn.classList.remove('timer-button-secondary');
            ivStartPauseBtn.classList.add('timer-button-primary');

            alert('„Ç§„É≥„Çø„Éº„Éê„É´ÁµÇ‰∫ÜÔºÅÊ¨°„ÅÆ„Çª„ÉÉ„Éà„Å´Áßª„Çä„Åæ„Åó„Çá„ÅÜÔºÅ');
        };

        const startInterval = () => {
            if (ivRemainingTime <= 0) {
                resetInterval();
                return;
            }
            
            if (!isIvRunning) {
                isIvRunning = true;
                ivStartPauseBtn.innerHTML = '<i class="fa-solid fa-pause"></i> ÂÅúÊ≠¢';
                ivStartPauseBtn.classList.remove('timer-button-primary');
                ivStartPauseBtn.classList.add('timer-button-secondary');

                const startTime = Date.now() - (ivInitialTime - ivRemainingTime);

                ivTimer = setInterval(() => {
                    const elapsedTime = Date.now() - startTime;
                    ivRemainingTime = ivInitialTime - elapsedTime;
                    
                    if (ivRemainingTime <= 0) {           
                        ivRemainingTime = 0;
                        updateIvDisplay();
                        handleIvFinish();
                        return;
                    }
                    updateIvDisplay();
                }, 100);
            } else {
                clearInterval(ivTimer);
                isIvRunning = false;
                ivInitialTime = ivRemainingTime;
                ivStartPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> ÂÜçÈñã';
                ivStartPauseBtn.classList.remove('timer-button-secondary');
                ivStartPauseBtn.classList.add('timer-button-primary');
            }
        };

        const resetInterval = () => {
            clearInterval(ivTimer);
            isIvRunning = false;

            const minutes = parseInt(ivMinInput.value) || 0;
            const seconds = parseInt(ivSecInput.value) || 0;
            
            const newInitialTime = (minutes * 60000) + (seconds * 1000);
            
            if (newInitialTime < 1000) {
                ivInitialTime = 60000;
                ivMinInput.value = 1;
                ivSecInput.value = 0;
            } else {
                ivInitialTime = newInitialTime;
            }

            ivRemainingTime = ivInitialTime;
            
            updateIvDisplay();
            ivStartPauseBtn.innerHTML = '<i class="fa-solid fa-play"></i> ÈñãÂßã';
            ivStartPauseBtn.classList.remove('timer-button-secondary');
            ivStartPauseBtn.classList.add('timer-button-primary');
        };

        if(ivSetBtn && ivStartPauseBtn && ivResetBtn) {
            ivSetBtn.addEventListener('click', resetInterval);
            ivStartPauseBtn.addEventListener('click', startInterval);
            ivResetBtn.addEventListener('click', resetInterval);
            resetInterval();
        }
    });
</script>
</body>
</html>























































