<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ガチャ | FitWorks</title>

    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <script th:src="@{/js/theme.js}"></script>

    <!-- （CSSは変更なしのため省略） -->
</head>

<body class="gacha-page">

<div class="interactive-bg">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <canvas id="bg-canvas"></canvas>
    <div class="bg-cloud cloud-1"></div>
    <div class="bg-cloud cloud-2"></div>
</div>

<div class="main-container">

    <!-- ヘッダー -->
    <div class="gacha-header">
        <h1 class="gacha-title">GACHA</h1>
        <p class="sub-heading">進化素材をあつめよう！</p>
    </div>

    <!-- チップ表示 -->
    <div class="status-bar">
        <div class="shaker-display">
            <i class="fa-solid fa-martini-glass-citrus shaker-icon"></i>
            <div class="shaker-info">
                <span class="shaker-count-label">所持チップ:</span>
                <span class="shaker-count-value" th:text="${chipCount}">0</span>
                <span class="shaker-unit">枚</span>
            </div>
        </div>
    </div>

    <!-- ガチャ演出 -->
    <div class="gacha-stage">
        <div class="stage-bg-effect"></div>
        <i class="fa-solid fa-gifts gacha-main-icon"></i>

        <div class="rate-button-wrapper">
            <button id="openModal" class="rate-button">
                <i class="fa-solid fa-list-ul"></i> 提供割合
            </button>
        </div>
    </div>

    <input type="hidden" id="chipCount" th:value="${chipCount}" />

    <div id="chipErrorBox" class="chip-error-box" style="display: none;">
        チップが足りません。
    </div>

    <!-- ▼ ガチャボタン -->
    <div class="action-area">

        <!-- 単発 -->
        <a th:href="@{/gacha/animation(userId=${userId}, count=1)}"
           class="gacha-btn btn-single"
           onclick="return checkChips(1)">
            <span class="btn-label">1回引く</span>
            <span class="btn-cost">消費: 1個</span>
        </a>

        <!-- ★ 10連 -->
        <a th:href="@{/gacha/animation(userId=${userId}, count=10)}"
           class="gacha-btn btn-multi"
           onclick="return checkChips(9)">
            <span class="btn-label">10連引く！</span>
            <span class="btn-cost">消費: 9個 (1回お得!)</span>
        </a>

    </div>

    <div class="footer-nav">
        <a th:href="@{/home}" class="home-btn">
            <i class="fa-solid fa-house-chimney"></i> ホームにもどる
        </a>
    </div>

</div>

<!-- ▼ JS -->
<script>
    // チップ不足チェック
    function checkChips(cost) {
        const chipCount = parseInt(document.getElementById("chipCount").value, 10);
        if (isNaN(chipCount) || chipCount < cost) {
            showChipError();
            return false;
        }
        return true;
    }

    function showChipError() {
        const box = document.getElementById("chipErrorBox");
        box.style.display = "block";
        setTimeout(() => {
            box.style.display = "none";
        }, 3000);
    }
</script>

</body>
</html>
