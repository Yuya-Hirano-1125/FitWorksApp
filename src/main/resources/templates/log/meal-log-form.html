<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿäº‹è¨˜éŒ² | FitWorks</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800;900&family=Noto+Sans+JP:wght@400;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/training-log.css}"> 
	
	<script th:src="@{/js/theme.js}"></script>
	<style>
	    /* ãƒ•ã‚©ãƒ¼ãƒ å†…å°‚ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
	    .meal-form-container {
	        text-align: left;
	        padding: 0 5px;
	    }

	    /* ãƒ•ã‚©ãƒ¼ãƒ ã®è¡Œãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
	    .form-row {
	        display: flex;
	        gap: 15px;
	        margin-bottom: 15px;
	    }

	    .form-group {
	        margin-bottom: 15px;
	    }

	    .form-group label {
	        display: block;
	        margin-bottom: 6px;
	        font-weight: 700;
	        color: #555;
	        font-size: 0.9em;
	    }

	    /* æ¨ªä¸¦ã³ç”¨ã®ã‚¯ãƒ©ã‚¹ */
	    .form-group.half {
	        flex: 1;
	    }

	    /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
	    .form-control {
	        width: 100%;
	        padding: 10px;
	        border: 2px solid #ddd;
	        border-radius: 8px;
	        box-sizing: border-box;
	        font-size: 1em;
	        transition: border-color 0.3s;
	        background-color: #fff;
	    }
	    .form-control:focus {
	        border-color: #4CAF50; /* ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ï¼ˆç·‘ï¼‰ */
	        outline: none;
	        box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
	    }
	    
	    /* èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ« */
	    .form-control[readonly] {
	        background-color: #f3f3f3;
	        color: #777;
	        cursor: not-allowed;
	    }

	    /* ãƒã‚¯ãƒ­æ „é¤Šç´ ï¼ˆPFCï¼‰ã®å…¥åŠ›ã‚¨ãƒªã‚¢ */
	    .macro-section {
	        background-color: #f9f9f9;
	        border: 1px dashed #ccc;
	        border-radius: 10px;
	        padding: 15px;
	    }
	    .macro-row {
	        display: flex;
	        gap: 10px;
	        justify-content: space-between;
	    }
	    .macro-item {
	        flex: 1;
	        text-align: center;
	    }
	    .macro-item label {
	        font-size: 0.85em;
	        color: #777;
	        margin-bottom: 3px;
	    }
	    .macro-input {
	        text-align: center;
	        font-weight: bold;
	    }
	    
	    /* PFCã”ã¨ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ */
	    .p-input:focus { border-color: #3498db !important; } /* Protein: é’ */
	    .f-input:focus { border-color: #e74c3c !important; } /* Fat: èµ¤ */
	    .c-input:focus { border-color: #f1c40f !important; } /* Carb: é»„ */

	    /* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
	    .text-danger {
	        color: #e74c3c;
	        font-size: 0.85em;
	        display: block;
	        margin-top: 5px;
	    }
	    
	    /* é€ä¿¡ãƒœã‚¿ãƒ³ */
	    .btn-submit {
	        width: 100%; 
	        margin-top: 20px; 
	        padding: 12px; 
	        font-size: 1.1em; 
	        background-color: #4CAF50; 
	        color: white; 
	        border: none; 
	        border-radius: 8px; 
	        cursor: pointer; 
	        font-weight: bold;
	        transition: background-color 0.2s, transform 0.1s;
	    }
	    .btn-submit:hover {
	        background-color: #45a049;
	        transform: translateY(-2px);
	    }
	</style>

	<div class="meal-form-container">
	    <form th:action="@{/log/meal/save}" th:object="${mealLogForm}" method="post">
	        
	        <div class="form-group">
	            <label for="date"><i class="fa-regular fa-calendar"></i> æ—¥ä»˜</label>
	            <input type="date" id="date" th:field="*{date}" class="form-control" readonly>
	            <div th:if="${#fields.hasErrors('date')}" th:errors="*{date}" class="text-danger"></div>
	        </div>

	        <div class="form-row">
	            <div class="form-group half">
	                <label for="time"><i class="fa-regular fa-clock"></i> æ™‚åˆ»</label>
	                <input type="time" id="time" th:field="*{time}" class="form-control" required>
	                <div th:if="${#fields.hasErrors('time')}" th:errors="*{time}" class="text-danger"></div>
	            </div>

	            <div class="form-group half">
	                <label for="mealType"><i class="fa-solid fa-utensils"></i> ç¨®é¡</label>
	                <select id="mealType" th:field="*{mealType}" class="form-control" required>
	                    <option value="æœé£Ÿ">æœé£Ÿ</option>
	                    <option value="æ˜¼é£Ÿ">æ˜¼é£Ÿ</option>
	                    <option value="å¤•é£Ÿ">å¤•é£Ÿ</option>
	                    <option value="é–“é£Ÿ">é–“é£Ÿ</option>
	                </select>
	                <div th:if="${#fields.hasErrors('mealType')}" th:errors="*{mealType}" class="text-danger"></div>
	            </div>
	        </div>
	        
	        <div class="form-group">
	            <label for="content">é£Ÿäº‹å†…å®¹</label>
	            <textarea id="content" th:field="*{content}" class="form-control" rows="2" placeholder="ä¾‹: ã”é£¯ã€ç„¼ãé­šã€å‘³å™Œæ±" required></textarea>
	            <div th:if="${#fields.hasErrors('content')}" th:errors="*{content}" class="text-danger"></div>
	        </div>

	        <div class="form-group">
	            <label for="calories">ğŸ”¥ ç·ã‚«ãƒ­ãƒªãƒ¼ (kcal)</label>
	            <input type="number" id="calories" th:field="*{calories}" class="form-control" placeholder="0" min="0" required>
	            <div th:if="${#fields.hasErrors('calories')}" th:errors="*{calories}" class="text-danger"></div>
	        </div>

	        <div class="form-group">
	            <label>PFCãƒãƒ©ãƒ³ã‚¹ (g) <span style="font-size:0.8em; font-weight:normal; color:#888;">â€»ä»»æ„</span></label>
	            <div class="macro-section">
	                <div class="macro-row">
	                    <div class="macro-item">
	                        <label for="protein">P (ã‚¿ãƒ³ãƒ‘ã‚¯è³ª)</label>
	                        <input type="number" id="protein" th:field="*{protein}" class="form-control macro-input p-input" step="0.1" min="0" placeholder="0.0">
	                    </div>
	                    <div class="macro-item">
	                        <label for="fat">F (è„‚è³ª)</label>
	                        <input type="number" id="fat" th:field="*{fat}" class="form-control macro-input f-input" step="0.1" min="0" placeholder="0.0">
	                    </div>
	                    <div class="macro-item">
	                        <label for="carbohydrate">C (ç‚­æ°´åŒ–ç‰©)</label>
	                        <input type="number" id="carbohydrate" th:field="*{carbohydrate}" class="form-control macro-input c-input" step="0.1" min="0" placeholder="0.0">
	                    </div>
	                </div>
	            </div>
	        </div>

	        <button type="submit" class="btn-submit">
	            <i class="fa-solid fa-check"></i> è¨˜éŒ²ã‚’ä¿å­˜
	        </button>
	    </form>
	</div>

<script th:inline="javascript">
    // â˜…å¤‰æ›´ç‚¹: é£Ÿäº‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚€é–¢æ•° (ç¨®é¡åˆ†å²ãªã—)
    function loadMealForm(date) {
        let url = /*[[@{/log/meal/form}]]*/ '/log/meal/form';
        url += '?date=' + date;

        fetch(url)
            .then(response => response.text())
            .then(html => {
                document.getElementById('formContainer').innerHTML = html;
            })
            .catch(error => {
                document.getElementById('formContainer').innerHTML = '<p class="error-message">ãƒ•ã‚©ãƒ¼ãƒ ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
                console.error('Form load error:', error);
            });
    }

    // è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‹ãé–¢æ•°
    function openLogModal(dateString, isLogged) {
        const [year, month, day] = dateString.split('-');
        const displayDate = `${year}å¹´${month}æœˆ${day}æ—¥`;
        
        // æ—¥ä»˜ã‚’ã‚»ãƒƒãƒˆ
        document.getElementById('selectedDateInput').value = dateString;
        document.getElementById('modalDateTitle').innerText = displayDate;
        
        const modal = document.getElementById('logModal');
        const formContainer = document.getElementById('formContainer');

        // ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒªã‚»ãƒƒãƒˆã¨èª­ã¿è¾¼ã¿é–‹å§‹
        formContainer.innerHTML = '<div style="padding:20px; text-align:center;"><i class="fa-solid fa-spinner fa-spin"></i> èª­ã¿è¾¼ã¿ä¸­...</div>';
        
        // â˜…å¤‰æ›´ç‚¹: å¸¸ã«é£Ÿäº‹ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒ­ãƒ¼ãƒ‰
        loadMealForm(dateString);

        // è¨˜éŒ²æ¸ˆã¿ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        const logViewArea = document.getElementById('logViewArea');
        if (isLogged) {
            logViewArea.innerHTML = '<p style="font-weight: 700; color: #4CAF50; margin-bottom: 10px;">âœ… ã“ã®æ—¥ã¯è¨˜éŒ²æ¸ˆã¿ã§ã™ã€‚</p>';
        } else {
            logViewArea.innerHTML = '<p style="color: #999; margin-bottom: 10px;">ã“ã®æ—¥ã¯ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
        }

        modal.classList.add('is-active');
    }

    // è¨˜éŒ²ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹é–¢æ•°
    function closeLogModal() {
        const modal = document.getElementById('logModal');
        modal.classList.remove('is-active');
        
        // ãƒªã‚»ãƒƒãƒˆ
        document.getElementById('formContainer').innerHTML = '<p>ãƒ•ã‚©ãƒ¼ãƒ ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...</p>';
    }

    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹å‡¦ç†
    window.onclick = function(event) {
        const modal = document.getElementById('logModal');
        if (modal.classList.contains('is-active') && event.target === modal) {
            closeLogModal();
        }
    }
</script>

</body>
</html>





