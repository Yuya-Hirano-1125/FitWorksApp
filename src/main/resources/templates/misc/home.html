<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ›ãƒ¼ãƒ  | FitWorks</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800;900&family=Noto+Sans+JP:wght@400;700;800&family=M+PLUS+Rounded+1c:wght@500;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <link rel="stylesheet" th:href="@{/css/title.css}">
    
    <script th:src="@{/js/theme.js}"></script>
	<style>
	        /* --- HTMLå†…ã‚¹ã‚¿ã‚¤ãƒ« (CSSãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã—ã¦ã„ãªã„å‹•çš„éƒ¨åˆ†ã®ã¿) --- */
	        :root { --primary-color: #ff69b4; }

	        .xp-bar { width: 100%; height: 25px; background: #e3f2fd; border-radius: 12px; overflow: hidden; margin-top: 8px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.2); }
	        .xp-progress { height: 100%; background: linear-gradient(90deg, #42a5f5, #2196f3); color: #fff; font-size: 12px; font-weight: bold; text-align: center; line-height: 25px; border-radius: 12px; transition: width 1s ease-in-out; }
	        
	        .character-section { position: relative; display: flex; justify-content: center; margin-top: 0px; }
	        
	        /* PCãƒ»å¤§ç”»é¢ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ (åŸºæœ¬è¨­å®š) */
	        .character-wrapper { 
	            position: relative; 
	            width: 400px; 
	            max-width: 100%; 
	            margin: 0 auto; 
	            overflow: visible; 
	            display: block; 
	        }

	        /* ç”»åƒã‚¨ãƒªã‚¢ */
	        .character-display { 
	            display: flex; justify-content: center; align-items: flex-end; 
	            width: 100%; 
	            height: 400px; 
	            background-repeat: no-repeat; background-position: center; background-size: cover; 
	            border-radius: 25px; 
	            box-shadow: 0 10px 30px rgba(33, 150, 243, 0.25); 
	            text-decoration: none; padding-bottom: 10px; box-sizing: border-box; 
	            border: 4px solid rgba(255,255,255,0.8);
	            z-index: 1; 
	        }
	        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-50px); } 100% { transform: translateY(0px); } }
	        .character-display img { width: auto; height: 85%; max-width: 95%; object-fit: contain; animation: float 3s ease-in-out infinite; filter: drop-shadow(0 20px 15px rgba(0,0,0,0.9)); }
	        
	        /* PCé…ç½®æ™‚ã®ä½ç½®èª¿æ•´ (top: 0 ã§ä¸Šè¾ºã‚’æƒãˆã‚‹) */
	        .character-side-buttons { 
	            position: absolute; 
	            display: flex; 
	            flex-direction: column; 
	            gap: 15px; 
	            z-index: 10; 
	            top: 80px; 
	            right: -115px; 
	        }

	        /* ãƒœã‚¿ãƒ³ã‚µã‚¤ã‚º (PCç”¨) */
	        .side-action-btn { 
	            color: white; padding: 10px 0; border-radius: 15px; text-decoration: none; 
	            font-weight: bold; 
	            font-size: 0.9em; 
	            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); 
	            transition: transform 0.1s; display: flex; align-items: center; justify-content: center; 
	            gap: 6px; 
	            width: 100px; 
	            backdrop-filter: blur(4px);
	        }
	        .side-action-btn:hover { transform: scale(1.05); }
	        
	        .title-button { background: linear-gradient(135deg, #9c27b0, #ba68c8); border: 2px solid rgba(255,255,255,0.3); }

	        /* æ­£æ–¹å½¢ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ (PCç”¨) */
	        .mission-square-btn {
	            height: 100px; 
	            flex-direction: column; 
	            background: linear-gradient(135deg, #ff9800, #f57c00);
	            border: 2px solid rgba(255,255,255,0.3);
	            font-size: 0.95em;
	        }
	        .mission-square-btn i {
	            font-size: 2.0rem; 
	            margin-bottom: 5px;
	        }

	        /* è¨˜éŒ²ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
	        .record-option-item {
	            transition: all 0.3s ease-out !important;
	            transform: translateY(0);
	        }
	        
	        .record-option-item:hover {
	            transform: translateY(-3px) !important;
	            box-shadow: 0 8px 20px rgba(0,0,0,0.15) !important;
	            z-index: 10;
	            filter: brightness(1.05);
	        }
	        
	        .record-option-item:active {
	            transform: translateY(1px) !important;
	            box-shadow: 0 2px 5px rgba(0,0,0,0.2) !important;
	            transition: all 0.1s ease !important;
	        }

	        /* ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
	        .help-menu-dropdown { 
	            display: none; 
	            position: absolute; 
	            top: 60px; right: 20px; left: auto; 
	            background: rgba(255, 255, 255, 0.98); 
	            border-radius: 15px; 
	            box-shadow: 0 10px 30px rgba(0,0,0,0.25); 
	            padding: 15px; 
	            z-index: 2000; 
	            width: 260px; 
	            flex-direction: column; 
	            gap: 8px; 
	            max-height: 80vh; 
	            overflow-y: auto;
	        }
	        .help-menu-dropdown.active { display: flex; animation: fadeInDown 0.3s ease; }
	        @keyframes fadeInDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
	        
	        .help-section-label {
	            font-size: 0.8rem;
	            color: #888;
	            font-weight: bold;
	            margin: 5px 0 2px 5px;
	            border-bottom: 1px solid #eee;
	            padding-bottom: 2px;
	        }

	        .help-menu-item { 
	            display: flex; align-items: center; gap: 10px;
	            padding: 12px; 
	            text-decoration: none; 
	            border-radius: 10px; 
	            text-align: left; 
	            font-weight: bold; 
	            font-size: 0.95em; 
	            transition: all 0.2s; 
	            border: none; 
	            width: 100%; 
	            cursor: pointer; 
	            color: #444; 
	            background: #f9f9f9;
	            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
	            box-sizing: border-box; 
	        }
	        .help-menu-item:hover { transform: translateX(5px); background: #e3f2fd; color: #0288d1; }
	        .help-menu-item i { width: 20px; text-align: center; color: #0288d1; }

	        .tutorial-pointer { position: absolute; z-index: 10000; font-size: 2.5rem; color: #f1c40f; display: none; animation: point-move 1s infinite alternate; text-shadow: 0 2px 5px rgba(0,0,0,0.5); }
	        .tutorial-pointer::before { content: '\f0a6'; font-family: "Font Awesome 6 Free"; font-weight: 900; }
	        @keyframes point-move { from { transform: translateY(0); } to { transform: translateY(-10px); } }
	        
	        .rpg-text-area { font-size: 1.25rem; font-weight: bold; line-height: 1.6; color: #333; }
	        
	        .home-greeting-container { text-align: center; margin-top: 30px; margin-bottom: 15px; }
	        .home-greeting-text { font-family: 'Noto Sans JP', sans-serif; color: #555; font-size: 1.1rem; font-weight: 700; margin-top: 0; line-height: 1.6; }
	        .home-username { color: #0288d1; font-size: 1.3rem; font-weight: 900; margin: 0 3px; text-decoration: underline wavy #4facfe; text-underline-offset: 4px; }

	        /* èƒŒæ™¯è§£æ”¾ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
	        .background-unlock-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 10000; animation: fadeIn 0.3s ease-in-out; }
	        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
	        .background-unlock-content { background: linear-gradient(180deg, #fffef7 0%, #faf8f0 100%); border: 6px solid #d4a373; border-radius: 30px; padding: 0; max-width: 520px; width: 90%; box-shadow: 0 0 0 3px #f5e6d3, 0 0 0 9px #d4a373, 0 15px 35px rgba(0, 0, 0, 0.3); animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55); position: relative; overflow: hidden; }
	        @keyframes popIn { 0% { transform: scale(0.5) rotate(-5deg); opacity: 0; } 60% { transform: scale(1.05) rotate(2deg); } 100% { transform: scale(1) rotate(0deg); opacity: 1; } }
	        .leaf-decoration { position: absolute; font-size: 2rem; opacity: 0.15; pointer-events: none; animation: leafFloat 4s ease-in-out infinite; }
	        .leaf-decoration::before { content: 'ğŸƒ'; }
	        .leaf-decoration:nth-child(1) { top: 15px; left: 15px; animation-delay: 0s; }
	        .leaf-decoration:nth-child(2) { top: 15px; right: 15px; animation-delay: 1s; }
	        .leaf-decoration:nth-child(3) { bottom: 15px; left: 15px; animation-delay: 2s; }
	        .leaf-decoration:nth-child(4) { bottom: 15px; right: 15px; animation-delay: 3s; }
	        @keyframes leafFloat { 0%, 100% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-10px) rotate(5deg); } }
	        .ff-header { background: linear-gradient(180deg, #9bcc7a 0%, #7db85e 100%); border-bottom: 5px solid #6a9c4f; border-radius: 24px 24px 0 0; padding: 25px 20px; position: relative; box-shadow: inset 0 2px 0 rgba(255, 255, 255, 0.4), 0 3px 0 rgba(106, 156, 79, 0.3); }
	        .ff-header::before { content: ''; position: absolute; top: 8px; left: 50%; transform: translateX(-50%); width: 60px; height: 4px; background: rgba(255, 255, 255, 0.5); border-radius: 2px; }
	        .background-unlock-title { color: #ffffff; font-size: 1.35rem; font-weight: bold; margin: 0; text-align: center; letter-spacing: 0.5px; font-family: Arial, sans-serif; text-shadow: 2px 2px 0 rgba(106, 156, 79, 0.8), -1px -1px 0 rgba(106, 156, 79, 0.3); }
	        .ff-content { padding: 30px 25px; position: relative; }
	        .background-unlock-list { background: #ffffff; border: 4px solid #e8d5b7; border-radius: 20px; padding: 20px; margin-bottom: 25px; box-shadow: inset 0 2px 0 rgba(0, 0, 0, 0.03), 0 3px 10px rgba(0, 0, 0, 0.1); position: relative; }
	        .background-unlock-item { background: linear-gradient(135deg, #fff9f0 0%, #fef5e7 100%); border: 3px solid #f4d9a6; border-radius: 15px; color: #5a4a3a; font-size: 1.05rem; font-weight: bold; margin: 12px 0; padding: 14px 18px; position: relative; animation: itemBounce 0.5s ease-out forwards; opacity: 0; box-shadow: 0 4px 0 #e8c78e, 0 5px 10px rgba(0, 0, 0, 0.1); transition: all 0.2s ease; }
	        .background-unlock-item:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 7px 0 #e8c78e, 0 8px 15px rgba(0, 0, 0, 0.15); }
	        @keyframes itemBounce { 0% { transform: scale(0.3) translateY(-20px); opacity: 0; } 50% { transform: scale(1.1) translateY(0); opacity: 1; } 100% { transform: scale(1) translateY(0); opacity: 1; } }
	        .background-unlock-item:nth-child(1) { animation-delay: 0.1s; }
	        .background-unlock-item:nth-child(2) { animation-delay: 0.2s; }
	        .background-unlock-item:nth-child(3) { animation-delay: 0.3s; }
	        .background-unlock-item:nth-child(4) { animation-delay: 0.4s; }
	        .background-unlock-item::before { content: 'âœ¿'; position: absolute; left: -18px; top: 50%; transform: translateY(-50%); color: #9bcc7a; font-size: 1.3rem; animation: flowerSpin 3s ease-in-out infinite; }
	        @keyframes flowerSpin { 0%, 100% { transform: translateY(-50%) rotate(0deg); } 50% { transform: translateY(-50%) rotate(180deg); } }
	        .background-unlock-item i { color: #f4a460; margin-right: 10px; font-size: 1.1rem; }
	        .background-unlock-item strong { color: #6a5a4a; }
	        .background-unlock-buttons { display: flex; gap: 12px; justify-content: center; padding: 0 25px 30px; position: relative; }
	        .background-unlock-buttons button, .background-unlock-buttons a { padding: 14px 26px; border: 4px solid #d4a373; border-radius: 50px; font-weight: bold; font-size: 0.95rem; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; position: relative; transition: all 0.2s ease; font-family: Arial, sans-serif; box-shadow: 0 5px 0 #b8906a, 0 6px 12px rgba(0, 0, 0, 0.15); }
	        .background-unlock-buttons button:active, .background-unlock-buttons a:active { transform: translateY(3px); box-shadow: 0 2px 0 #b8906a, 0 3px 6px rgba(0, 0, 0, 0.15); }
	        .background-unlock-buttons button:hover, .background-unlock-buttons a:hover { transform: translateY(-2px); box-shadow: 0 7px 0 #b8906a, 0 8px 16px rgba(0, 0, 0, 0.2); }
	        .btn-later { background: linear-gradient(180deg, #f4e4c1 0%, #e8d5b7 100%); color: #6a5a4a; border-color: #d4a373; }
	        .btn-go-backgrounds { background: linear-gradient(180deg, #9bcc7a 0%, #7db85e 100%); color: #ffffff; border-color: #6a9c4f; box-shadow: 0 5px 0 #5a8c3f, 0 6px 12px rgba(0, 0, 0, 0.15); }
	        .btn-go-backgrounds:active { box-shadow: 0 2px 0 #5a8c3f, 0 3px 6px rgba(0, 0, 0, 0.15); }
	        .btn-go-backgrounds:hover { box-shadow: 0 7px 0 #5a8c3f, 0 8px 16px rgba(0, 0, 0, 0.2); }
	        .btn-go-backgrounds i { color: #f4d9a6; }
	        
	        .tutorial-backdrop, .tutorial-spotlight, .tutorial-pointer, .tutorial-rpg-box { pointer-events: none; }
	        .tutorial-backdrop.active, .tutorial-rpg-box.active { pointer-events: auto; }
	        .interactive-bg, .mouse-follower-cloud, .bg-cloud { pointer-events: none !important; z-index: -1; }
	        #tutorial-rpg-box { z-index: 10001; }
	        
	        .menu-item-spacing { margin-top: 20px !important; width: 100%; box-sizing: border-box; display: block; }
	        .care-section { text-align: center; }
			/* æ ç·šå‰Šé™¤ãªã©ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ */
			        .btn-record, .btn-care, .home-action-btn, .side-action-btn, .title-button { 
			            border: none !important; outline: none !important; 
			        }

			/* ---------------------------------------------------------
			           â–¼â–¼â–¼ ãƒœãƒˆãƒ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ (å…¨ç”»é¢å…±é€š) â–¼â–¼â–¼
			           â€»ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒªã®å¤–ã«å‡ºã—ã¦ã‚¹ãƒãƒ›ã§ã‚‚é©ç”¨ã•ã‚Œã‚‹ã‚ˆã†ã«ä¿®æ­£
			           --------------------------------------------------------- */
			        .main-container { padding-bottom: 150px !important; }
			        
			        #tutorial-menu-nav.bottom-nav {
			            display: flex !important; /* å¼·åˆ¶çš„ã«è¡¨ç¤º */
			            justify-content: space-evenly; 
			            align-items: center;
			            position: fixed; 
			            bottom: 20px; 
			            left: 50%; 
			            transform: translateX(-50%);
			            width: 95%; 
			            max-width: 800px;
			            background: rgba(255, 255, 255, 0.95); 
			            backdrop-filter: blur(10px);
			            border-radius: 50px; 
			            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
			            padding: 10px 15px; 
			            box-sizing: border-box; 
			            z-index: 1000;
			            visibility: visible !important;
			            opacity: 1 !important;
			        }
			        
			        #tutorial-menu-nav .nav-item {
			            display: flex; 
			            flex-direction: column; 
			            justify-content: center; 
			            align-items: center;
			            flex: 1; 
			            height: auto; 
			            min-height: 60px;
			            text-decoration: none; 
			            color: #555; 
			            border-radius: 12px;
			            transition: transform 0.2s ease, background 0.2s; 
			            padding: 5px 0; 
			            margin: 0 5px;
			        }
			        
			        #tutorial-menu-nav .nav-item i { 
			            display: block; 
			            font-size: 22px; 
			            margin-bottom: 5px; 
			            line-height: 1; 
			            color: var(--primary-color, #ff69b4); 
			        }
			        
			        #tutorial-menu-nav .nav-item span { 
			            display: block; 
			            font-size: 11px; 
			            font-weight: bold; 
			            white-space: nowrap; 
			            line-height: 1.2; 
			            width: 100%; 
			            text-align: center; 
			        }
			        
			        #tutorial-menu-nav .nav-item:hover { 
			            background-color: #f0f8ff; 
			            transform: translateY(-3px); 
			        }

					/* ãƒŸãƒƒã‚·ãƒ§ãƒ³é”æˆé€šçŸ¥ */
					        .mission-notification {
					            position: fixed;
					            top: 20px;
					            left: 50%;
					            transform: translateX(-50%);
					            background: linear-gradient(135deg, #ff9800, #f57c00);
					            color: white;
					            padding: 15px 30px;
					            border-radius: 50px;
					            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
					            z-index: 20000;
					            font-weight: bold;
					            font-size: 1.1rem;
					            display: flex;
					            align-items: center;
					            gap: 10px;
					            animation: slideDownFade 0.5s ease-out forwards;
					            pointer-events: none; 
					        }
					        @keyframes slideDownFade { from { top: -50px; opacity: 0; } to { top: 20px; opacity: 1; } }
					        .mission-notification.fade-out { animation: fadeOutUp 0.5s ease-in forwards; }
					        @keyframes fadeOutUp { from { top: 20px; opacity: 1; } to { top: -50px; opacity: 0; } }

							/* ---------------------------------------------------------
							           â–¼â–¼â–¼ ã‚¹ãƒãƒ›ã‚µã‚¤ã‚ºä½™ç™½èª¿æ•´ & ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆåˆ‡ã‚Šæ›¿ãˆ â–¼â–¼â–¼
							           --------------------------------------------------------- */
						   @media (max-width: 750px) {
					            /* â˜…ä¿®æ­£1: å…¨ä½“ã®ä¸‹éƒ¨ä½™ç™½ã‚’è©°ã‚ã‚‹ (150px -> 100px) */
						               .main-container { padding-bottom: 120px !important; }

						               /* â˜…ä¿®æ­£2: AIãƒœã‚¿ãƒ³ä¸‹ã®ä½™ç™½ã‚’ã•ã‚‰ã«è©°ã‚ã‚‹ (20px -> 10px) */
						               #tutorial-ai-btn { margin-bottom: 10px !important; }

						               /* ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
						               .character-wrapper {
						                   display: flex;
						                   flex-direction: column;
						                   height: auto; 
						                   width: 95%;
						                   overflow: visible;
						                   margin-top: 10px;
						               }

						               .character-display {
						                   width: 100%;
						                   /* ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã§æ­£æ–¹å½¢ã‚’ç¶­æŒ */
						                   height: auto;
						                   aspect-ratio: 1 / 1; 
						                   order: 3; 
						               }

						               .character-side-buttons {
						                   position: static; 
						                   display: flex;
						                   flex-direction: row; 
						                   justify-content: space-between;
						                   width: 100%;
									                   /* ä¸Šã«ãƒãƒ¼ã‚¸ãƒ³ã‚’è¿½åŠ ã—ã¦ãƒœã‚¿ãƒ³ä½ç½®ã‚’ä¸‹ã’ã‚‹ (-10px -> -10pxã®ã¾ã¾ç¶­æŒã€ã‚‚ã—ãã¯èª¿æ•´) */
									                   /* ä»Šå›ã¯é–“éš”è©°ã‚ãŒç›®çš„ãªã®ã§ã€ã“ã“ã®ãƒãƒ¼ã‚¸ãƒ³ã¯ç¶­æŒã—ã¾ã™ */
									                   margin: -10px 0 20px 0;
									                   gap: 10px;
									                   order: 1; 
									                   top: auto;
									                   right: auto;
									               }

									               #tutorial-title-display {
									                   order: 2; 
									                   margin-top: 30px !important;
									                   margin-bottom: 0px;
									               }

									               .side-action-btn {
									                   width: 48%;       
									                   height: 55px;     
									                   font-size: 0.95rem;
									                   margin: 0;
									                   display: flex;
									                   align-items: center;
									                   justify-content: center;
									                   flex-direction: row;
									               }

									               .mission-square-btn {
									                   height: 55px;
									                   flex-direction: row;
									               }
									               
									               .mission-square-btn i {
									                   font-size: 1.2rem;
									                   margin-bottom: 0;
									                   margin-right: 8px;
									               }
									           }
	    </style>
</head>
<body class="home-page">

<div th:if="${missionAchieved}" id="mission-notification" class="mission-notification">
    <i class="fa-solid fa-trophy"></i> ãƒŸãƒƒã‚·ãƒ§ãƒ³é”æˆï¼å ±é…¬ã‚’å—ã‘å–ã‚Šã¾ã—ã‚‡ã†ï¼
</div>

<div class="interactive-bg">
    <div class="mouse-follower-cloud"></div>
    <div class="bg-cloud cloud-1"></div>
    <div class="bg-cloud cloud-2"></div>
    <div class="bg-cloud cloud-3"></div>
    <div class="bg-cloud cloud-4"></div>
</div>

<div class="main-container" style="position: relative;"> 
    <div id="real-time-clock" class="real-time-clock">0000/00/00(æœˆ) 00:00</div>

    <button id="help-btn" class="help-label-btn" onclick="toggleHelpMenu()">
        <i class="fa-solid fa-circle-question" style="font-size: 1.2em;"></i> ãƒ˜ãƒ«ãƒ—
    </button>
    
    <div id="help-menu" class="help-menu-dropdown">
        <div class="help-section-label">ğŸ”° ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</div>
        <button class="help-menu-item tutorial-opt" onclick="startRpgTutorial('all'); toggleHelpMenu();">
            <i class="fa-solid fa-star"></i> å…¨æ©Ÿèƒ½ãƒ„ã‚¢ãƒ¼
        </button>
        <button class="help-menu-item" onclick="startRpgTutorial('training'); toggleHelpMenu();">
            <i class="fa-solid fa-dumbbell"></i> ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å§‹ã‚æ–¹
        </button>
        <button class="help-menu-item" onclick="startRpgTutorial('record'); toggleHelpMenu();">
            <i class="fa-solid fa-pen-to-square"></i> è¨˜éŒ²ã®ä»˜ã‘æ–¹ãƒ»ã‚±ã‚¢
        </button>
        <button class="help-menu-item" onclick="startRpgTutorial('gacha'); toggleHelpMenu();">
            <i class="fa-solid fa-gift"></i> ã‚¬ãƒãƒ£ãƒ»ã‚­ãƒ£ãƒ©ã«ã¤ã„ã¦
        </button>
        <button class="help-menu-item" onclick="startRpgTutorial('social'); toggleHelpMenu();">
            <i class="fa-solid fa-users"></i> äº¤æµãƒ»AIãƒ»ãã®ä»–
        </button>

        <div class="help-section-label">ğŸ“˜ ã‚¬ã‚¤ãƒ‰</div>
        <a th:href="@{/supplement-guide}" class="help-menu-item supple-opt">
            <i class="fa-solid fa-book-medical"></i> ã‚µãƒ—ãƒªã®é£²ã¿æ–¹
        </a>
        
        <div style="text-align: center; margin-top: 10px; padding-top: 10px; border-top: 1px dashed rgba(0,0,0,0.1);">
            <p style="margin: 0 0 5px 0; font-size: 0.85rem; font-weight: 800; color: #06c755; text-shadow: 0 1px 1px rgba(255,255,255,0.8);">
                <i class="fa-brands fa-line"></i> å…¬å¼LINEã¯ã“ã¡ã‚‰
            </p>
            <a href="https://lin.ee/nUEWQkq">
                <img src="https://scdn.line-apps.com/n/line_add_friends/btn/ja.png" alt="å‹ã ã¡è¿½åŠ " height="36" border="0">
            </a>
        </div>
    </div>

    <div class="app-logo-display">
        <img th:src="@{/img/applogo-new.png}" alt="App Logo" />
        <div id="tutorial-xp-area">
            <div class="xp-daily-header"></div>
            <div class="xp-bar-container">
                <span th:text="'ãƒ¬ãƒ™ãƒ« ' + ${level} + ' (XP: ' + ${experiencePoints} + '/' + ${requiredXp} + ')'"></span>
                <div class="xp-bar">
                    <div class="xp-progress" th:style="'width:' + ${progressPercent} + '%;'" th:text="${progressPercent} + '%'"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="character-section">
        <div class="character-wrapper">
            <div id="tutorial-title-display" style="text-align: center; margin-top: 5px; min-height: 30px;">
                <th:block th:if="${userTitle != null and userTitle != 'ãªã—'}">
                    <th:block th:each="enumT : ${T(com.example.demo.entity.AppTitle).values()}" 
                              th:if="${enumT.displayName == userTitle}">
                        <div class="title-badge" th:classappend="${enumT.rarity}">
                            <i class="fa-solid fa-crown"></i> <span th:text="${userTitle}"></span>
                        </div>
                    </th:block>
                </th:block>
            </div>

            <div id="tutorial-char-display" class="character-display"
                            th:style="'background-image: url(/img/background/' + ${selectedBackground} + '.png);'">
                <img th:src="@{'/img/character/' + ${(level / 10) * 10} + '.png'}" alt="Character" />
            </div>
            
            <div class="character-side-buttons">
                <a id="tutorial-title-btn" th:href="@{/titles}" class="side-action-btn title-button">
                    <i class="fa-solid fa-crown"></i> ç§°å·
                </a>
                
                <a id="tutorial-mission-btn" th:href="@{/daily-mission}" class="side-action-btn mission-square-btn">
                   <i class="fa-solid fa-list-check"></i> ãƒŸãƒƒã‚·ãƒ§ãƒ³
                </a>
            </div>
        </div>
    </div>
    
    <div class="home-greeting-container">
        <p class="home-greeting-text">
            ã“ã‚“ã«ã¡ã¯ã€<span class="home-username" th:text="${username}"></span>ã•ã‚“!
        </p>
    </div>
    
    <div class="ai-home-advice-container">
        <div class="ai-avatar-small">
            <img th:src="@{/img/AIcoach.png}" alt="AI">
        </div>
        <div class="ai-bubble-content">
             <p id="ai-home-message">ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è¨ºæ–­ä¸­<span class="loading-dots">...</span></p>
        </div>
    </div>
    
    <a id="tutorial-training-btn" th:href="@{/training}" class="home-action-btn btn-training menu-item-spacing">
           <i class="fa-solid fa-dumbbell"></i> ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ 
        </a>

        <div id="tutorial-record-btn" class="record-container menu-item-spacing">
            <button id="tutorial-record-toggle" onclick="toggleRecordMenu()" class="home-action-btn btn-record" style="width: 100%;">
               <i class="fa-solid fa-pen-to-square"></i> è¨˜éŒ²ã‚’ã¤ã‘ã‚‹
            </button>
            
            <div id="record-options" class="record-options">
                <a id="tutorial-record-log" th:href="@{/training-log}" class="record-option-item training-log-opt">
                    <i class="fa-solid fa-calendar-days"></i><br>ç­‹ãƒˆãƒ¬å±¥æ­´
                </a>
                <a id="tutorial-record-meal" th:href="@{/log/meal}" class="record-option-item meal-opt">
                    <i class="fa-solid fa-utensils"></i><br>é£Ÿäº‹è¨˜éŒ²
                </a>
                <a id="tutorial-record-weight" th:href="@{/training-log/form/body-weight}" class="record-option-item weight-opt">
                    <i class="fa-solid fa-weight-scale"></i><br>ä½“é‡è¨˜éŒ²
                </a>
            </div>
        </div>
        
        <div class="care-section menu-item-spacing">
            <a id="tutorial-care-btn" th:href="@{/training/care}" class="home-action-btn btn-care">
                <i class="fa-solid fa-mug-hot"></i> AIãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥&ã‚±ã‚¢
            </a>
        </div>

        <a id="tutorial-map-btn" th:href="@{/training/map}" class="home-action-btn btn-map menu-item-spacing">
           <i class="fa-solid fa-map-location-dot"></i> è¿‘ãã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°æ–½è¨­ 
        </a>
        
        <a id="tutorial-ai-btn" th:href="@{/ai-coach}" class="home-action-btn btn-ai menu-item-spacing">
           <i class="fa-solid fa-robot"></i> AIãƒãƒ£ãƒƒãƒˆ 
        </a>

    <nav id="tutorial-menu-nav" class="bottom-nav">
        <a id="nav-gacha" th:href="@{/gacha}" class="nav-item"><i class="fa-solid fa-gift"></i><span>ã‚¬ãƒãƒ£ã€€</span></a>
        <a id="tutorial-friends-btn" th:href="@{/friends}" class="nav-item"><i class="fa-solid fa-user-group"></i><span>ãƒ•ãƒ¬ãƒ³ãƒ‰</span></a>
        <a id="nav-community" th:href="@{/community}" class="nav-item"><i class="fa-solid fa-comments"></i><span>æ²ç¤ºæ¿ã€€</span></a>
        <a id="nav-char" th:href="@{/characters/menu/CharactersMenu}" class="nav-item"><i class="fa-solid fa-user-astronaut"></i><span>ã‚­ãƒ£ãƒ©ã€€</span></a>    
        <a id="tutorial-muscles-btn" th:href="@{/muscles}" class="nav-item"><i class="fa-solid fa-child-reaching"></i><span>ç­‹è‚‰ã€€</span></a>
        <a id="nav-settings" th:href="@{/settings}" class="nav-item"><i class="fa-solid fa-gear"></i><span>è¨­å®š</span></a>
    </nav>
</div>

<div id="tutorial-spotlight" class="tutorial-spotlight"></div>
<div id="tutorial-pointer" class="tutorial-pointer"></div>
<div id="tutorial-rpg-box" class="tutorial-rpg-box">
    <div class="rpg-char-area"><img id="rpg-char-img" th:src="@{/img/AIcoach.png}" alt="AI Coach"></div>
    <div class="rpg-content">
        <div class="rpg-name-tag">AIã‚³ãƒ¼ãƒ</div>
        <div class="rpg-text-area" id="rpg-text"></div>
        <div class="rpg-controls">
            <button class="rpg-btn rpg-btn-skip" onclick="endRpgTutorial()">çµ‚äº†</button>
            <button class="rpg-btn rpg-btn-next" id="rpg-next-btn" onclick="nextRpgStep()">æ¬¡ã¸</button>
        </div>
    </div>
</div>

<div id="background-unlock-popup" class="background-unlock-overlay" style="display: none;">
    <div class="background-unlock-content">
        <div class="leaf-decoration"></div>
        <div class="leaf-decoration"></div>
        <div class="leaf-decoration"></div>
        <div class="leaf-decoration"></div>

        <div class="ff-header">
            <h2 class="background-unlock-title">ã‚ãŸã‚‰ã—ã„èƒŒæ™¯ãŒæ‰‹ã«å…¥ã£ãŸã‚ˆ!</h2>
        </div>

        <div class="ff-content">
            <div id="background-unlock-list" class="background-unlock-list">
                </div>
        </div>

        <div class="background-unlock-buttons">
            <button onclick="closeBackgroundUnlockPopup()" class="btn-later">
                <i class="fa-solid fa-clock"></i>
                ã‚ã¨ã§è¦‹ã‚‹
            </button>
            <a href="/characters/menu/Backgrounds" class="btn-go-backgrounds">
                <i class="fa-solid fa-image"></i>
                èƒŒæ™¯ä¸€è¦§ã¸
            </a>
        </div>
    </div>
</div>

<div id="tutorial-backdrop" class="tutorial-backdrop"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    document.addEventListener('DOMContentLoaded', function() {
        const backgroundUnlocks = /*[[${backgroundUnlocks}]]*/ null;
        
        console.log('========== èƒŒæ™¯è§£æ”¾ãƒã‚§ãƒƒã‚¯ ==========');
        console.log('backgroundUnlocks:', backgroundUnlocks);
        console.log('====================================');
        
        if (backgroundUnlocks && backgroundUnlocks.hasNewUnlocks) {
            const unlockedBackgrounds = backgroundUnlocks.unlockedBackgrounds || [];
            if (unlockedBackgrounds.length > 0) {
                const popup = document.getElementById('background-unlock-popup');
                const listContainer = document.getElementById('background-unlock-list');
                listContainer.innerHTML = '';
                unlockedBackgrounds.forEach(bg => {
                    const item = document.createElement('div');
                    item.className = 'background-unlock-item';
                    item.innerHTML = `<i class="fa-solid fa-unlock-keyhole"></i><strong>${bg.name}</strong> (Lv.${bg.requiredLevel}ã§è§£æ”¾)`;
                    listContainer.appendChild(item);
                });
                popup.style.display = 'flex';
            }
        }
        
        const notification = document.getElementById('mission-notification');
        if (notification) {
            setTimeout(() => {
                notification.classList.add('fade-out');
                setTimeout(() => {
                    if (notification.parentNode) notification.parentNode.removeChild(notification);
                }, 500); 
            }, 4000); 
        }
        
        const aiMessageEl = document.getElementById('ai-home-message');
        if (aiMessageEl) {
            fetch('/api/ai-coach/home-advice')
                .then(res => res.text())
                .then(text => {
                    aiMessageEl.innerHTML = '';
                    let i = 0;
                    const speed = 40; 
                    function typeWriter() {
                        if (i < text.length) { aiMessageEl.textContent += text.charAt(i); i++; setTimeout(typeWriter, speed); }
                    }
                    typeWriter();
                })
                .catch(err => { console.error("AI Advice Error:", err); aiMessageEl.textContent = "ä»Šæ—¥ã‚‚ä¸€ç·’ã«é ‘å¼µã‚‹ãƒ ã‚­ï¼"; });
        }

        function updateRealTimeClock() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
            const dayOfWeek = days[now.getDay()];
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const timeString = `${year}/${month}/${day}(${dayOfWeek}) ${hours}:${minutes}`;
            const clockEl = document.getElementById('real-time-clock');
            if (clockEl) { clockEl.textContent = timeString; }
        }
        
        setInterval(updateRealTimeClock, 1000);
        updateRealTimeClock();
    });

    function closeBackgroundUnlockPopup() {
        document.getElementById('background-unlock-popup').style.display = 'none';
    }
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeBackgroundUnlockPopup(); });
    /*]]>*/

    function toggleRecordMenu() {
        const options = document.getElementById('record-options');
        options.classList.toggle('open');
    }
    function openRecordMenu() {
        const options = document.getElementById('record-options');
        if (!options.classList.contains('open')) options.classList.add('open');
    }
    function closeRecordMenu() {
        const options = document.getElementById('record-options');
        if (options.classList.contains('open')) options.classList.remove('open');
    }

    function toggleHelpMenu() {
        const menu = document.getElementById('help-menu');
        menu.classList.toggle('active');
    }

    document.addEventListener('click', function(event) {
        const menu = document.getElementById('help-menu');
        const btn = document.getElementById('help-btn');
        if (!menu.contains(event.target) && !btn.contains(event.target) && menu.classList.contains('active')) {
            menu.classList.remove('active');
        }
    });

    const scenarios = {
        'all': [
            { text: "FitWorksã¸ã‚ˆã†ã“ã!\nã“ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§ã¯ã€ã‚¢ãƒ—ãƒªã®å…¨æ©Ÿèƒ½ã‚’ã”ç´¹ä»‹ã—ã¾ã™!" },
            { targetId: 'help-btn', text: "ã¾ãšã¯ç”»é¢å·¦ä¸Šã€‚ã€Œãƒ˜ãƒ«ãƒ—ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ã€\nå„æ©Ÿèƒ½ã®è©³ã—ã„ä½¿ã„æ–¹ã‚„ã€ã‚µãƒ—ãƒªãƒ¡ãƒ³ãƒˆã®çŸ¥è­˜ã‚’ç¢ºèªã§ãã¾ã™ã€‚" },
            { targetId: 'tutorial-xp-area', text: "ç”»é¢ä¸Šéƒ¨ã«ã¯ã‚ãªãŸã®ã€Œãƒ¬ãƒ™ãƒ«ã€ã¨ã€ŒXP(çµŒé¨“å€¤)ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\nãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’è¨˜éŒ²ã—ã¦ãƒ¬ãƒ™ãƒ«ã‚’ä¸Šã’ã¾ã—ã‚‡ã†!" },
            { targetId: 'tutorial-mission-btn', text: "ã€ŒãƒŸãƒƒã‚·ãƒ§ãƒ³ã€ãƒœã‚¿ãƒ³ã¯ã“ã“ã«ç§»å‹•ã—ã¾ã—ãŸã€‚\næ¯æ—¥æ›´æ–°ã•ã‚Œã‚‹ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã€å ±é…¬ã‚’ã‚²ãƒƒãƒˆã—ã¾ã—ã‚‡ã†!" },
            { targetId: 'tutorial-title-display', text: "ã“ã“ã«ã¯ç¾åœ¨è£…å‚™ã—ã¦ã„ã‚‹ã€Œç§°å·ã€ãŒè¼ãã¾ã™ã€‚\nãƒ¬ã‚¢ãªç§°å·ã‚’æ‰‹ã«å…¥ã‚Œã¦ã€å¼·ã•ã‚’ã‚¢ãƒ”ãƒ¼ãƒ«ã—ã¦ãã ã•ã„!" },
            { targetId: 'tutorial-char-display', text: "ã‚ãªãŸã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã§ã™ã€‚\nãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ã¨å…±ã«é€²åŒ–ã—ã¦ã„ãå§¿ã‚’è¦‹å®ˆã‚Šã¾ã—ã‚‡ã†ã€‚" },
            { targetId: 'tutorial-training-btn', text: "ãƒ¡ã‚¤ãƒ³æ©Ÿèƒ½ã¯ã“ã‚Œ!ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã€‚\nã“ã“ã‹ã‚‰æ—¥ã€…ã®é‹å‹•ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œæˆãƒ»è¨˜éŒ²ã—ã¾ã™ã€‚" },
            { targetId: 'tutorial-record-btn', text: "ã€Œè¨˜éŒ²ã‚’ã¤ã‘ã‚‹ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰ã¯ã€\néå»ã®å±¥æ­´ç¢ºèªã‚„ã€é£Ÿäº‹ãƒ»ä½“é‡ã®è¨˜éŒ²ãŒå€‹åˆ¥ã«ã§ãã¾ã™ã€‚" },
            { targetId: 'tutorial-care-btn', text: "ç–²ã‚ŒãŸæ™‚ã¯ã€ŒAIãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥&ã‚±ã‚¢ã€ã€‚\nä½“èª¿ã«åˆã‚ã›ãŸã‚¹ãƒˆãƒ¬ãƒƒãƒã‚„ä¼‘æ¯æ³•ã‚’AIãŒææ¡ˆã—ã¾ã™ã€‚" },
            { targetId: 'nav-gacha', text: "ã“ã“ã‹ã‚‰ã¯ä¸‹ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã™ã€‚\nã€Œã‚¬ãƒãƒ£ã€ã§ã¯ã€ç€ã›æ›¿ãˆã‚¢ã‚¤ãƒ†ãƒ ãªã©ã®å ±é…¬ãŒæ‰‹ã«å…¥ã‚Šã¾ã™ã€‚" },
            { targetId: 'tutorial-friends-btn', text: "ã€Œãƒ•ãƒ¬ãƒ³ãƒ‰ã€æ©Ÿèƒ½ã§ä»²é–“ã¨ã¤ãªãŒã‚Šã¾ã—ã‚‡ã†ã€‚\nãŠäº’ã„ã«åŠ±ã¾ã—åˆã£ãŸã‚Šã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ç«¶ãˆã¾ã™ã€‚" },
            { targetId: 'nav-community', text: "ã€Œæ²ç¤ºæ¿ã€ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼åŒå£«ã®äº¤æµã‚¹ãƒšãƒ¼ã‚¹ã€‚\nç­‹ãƒˆãƒ¬æƒ…å ±ã®äº¤æ›ã‚„ã€é›‘è«‡ã§ç››ã‚Šä¸ŠãŒã‚Šã¾ã—ã‚‡ã†ã€‚" },
            { targetId: null, text: "æ©Ÿèƒ½èª¬æ˜ã¯ä»¥ä¸Šã§ã™ã€‚\næ°—ã«ãªã‚‹æ©Ÿèƒ½ã®è©³ç´°ã¯ã€ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å€‹åˆ¥ã‚¬ã‚¤ãƒ‰ã‚‚è¦‹ã¦ã­ï¼" }
        ],
        'training': [
            { text: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å§‹ã‚æ–¹ã«ã¤ã„ã¦è§£èª¬ã™ã‚‹ã‚ˆï¼\næº–å‚™ã¯ã„ã„ã‹ãªï¼Ÿ" },
            { targetId: 'tutorial-training-btn', text: "ã¾ãšã¯ã“ã®ã€Œãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚’é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ï¼\nã“ã“ã‹ã‚‰ãã®æ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ä½œã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã€‚" },
            { targetId: 'tutorial-training-btn', text: "ä¸­ã«å…¥ã‚‹ã¨ã€Œãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆã€ç”»é¢ã«ãªã‚‹ã‚ˆã€‚\néƒ¨ä½ã‚’é¸ã‚“ã§ç¨®ç›®ã‚’è¿½åŠ ã—ã¦ã„ã“ã†ï¼" },
            { targetId: 'tutorial-record-log', preAction: openRecordMenu, text: "éå»ã«ã‚„ã£ãŸç­‹ãƒˆãƒ¬ã®å±¥æ­´ã‚’è¦‹ãŸã„æ™‚ã¯ã“ã“ï¼\nã€Œç­‹ãƒˆãƒ¬å±¥æ­´ã€ã‹ã‚‰å‰å›é‡é‡ãªã©ã‚’ãƒã‚§ãƒƒã‚¯ã§ãã‚‹ã‚ˆã€‚" },
            { targetId: 'tutorial-map-btn', preAction: closeRecordMenu, text: "ã¾ã ã‚¸ãƒ ãŒæ±ºã¾ã£ã¦ã„ãªã„æ™‚ã¯ã“ã“ï¼\nè¿‘ãã®ã‚¸ãƒ ã‚„å…¬åœ’ã‚’ãƒãƒƒãƒ—ã§æ¢ã›ã‚‹ä¾¿åˆ©æ©Ÿèƒ½ã ã‚ˆã€‚" },
            { text: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã¯ç¶™ç¶šãŒå¤§äº‹ï¼\nã¾ãšã¯è»½ã„ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰å§‹ã‚ã¦ã¿ã‚ˆã†ï¼" }
        ],
        'record': [
            { text: "è¨˜éŒ²ã¨ãƒœãƒ‡ã‚£ã‚±ã‚¢ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã‚ˆï¼" },
            { targetId: 'tutorial-record-btn', text: "è¨˜éŒ²ã‚’ã¤ã‘ã‚‹ã¨ãã¯ã€ã“ã®ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã“ã†ã€‚" },
            { targetId: 'tutorial-record-log', preAction: openRecordMenu, text: "ã€ç­‹ãƒˆãƒ¬å±¥æ­´ã€‘\næ—¥ã€…ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°çµæœã¯ã“ã“ã«è‡ªå‹•ã§ä¿å­˜ã•ã‚Œã¦ã„ãã‚ˆã€‚" },
            { targetId: 'tutorial-record-meal', preAction: openRecordMenu, text: "ã€é£Ÿäº‹è¨˜éŒ²ã€‘\né£Ÿã¹ãŸã‚‚ã®ã‚’è¨˜éŒ²ã—ã¦ã€PFCãƒãƒ©ãƒ³ã‚¹ï¼ˆã‚¿ãƒ³ãƒ‘ã‚¯è³ªãªã©ï¼‰ã‚’ç®¡ç†ã—ã‚ˆã†ï¼" },
            { targetId: 'tutorial-record-weight', preAction: openRecordMenu, text: "ã€ä½“é‡è¨˜éŒ²ã€‘\nä½“é‡ã‚„ä½“è„‚è‚ªç‡ã®å¤‰åŒ–ã‚’ã‚°ãƒ©ãƒ•ã§ç¢ºèªã§ãã‚‹ã‚ˆã€‚" },
            { targetId: 'tutorial-care-btn', preAction: closeRecordMenu, text: "ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã®å¾Œã¯ã‚±ã‚¢ã‚‚å¿˜ã‚Œãšã«ï¼\nAIãŒç–²ã‚Œå…·åˆã«åˆã‚ã›ã¦ã€æœ€é©ãªã‚¹ãƒˆãƒ¬ãƒƒãƒã‚’æ•™ãˆã¦ãã‚Œã‚‹ã‚ˆã€‚" },
            { text: "ã—ã£ã‹ã‚Šè¨˜éŒ²ã—ã¦ã€è‡ªåˆ†ã®æˆé•·ã‚’å¯è¦–åŒ–ã—ã‚ˆã†ï¼" }
        ],
        'gacha': [
            { text: "ãŠæ¥½ã—ã¿è¦ç´ ã€ã‚¬ãƒãƒ£ã¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã«ã¤ã„ã¦ç´¹ä»‹ã™ã‚‹ã‚ˆï¼" },
            { targetId: 'nav-gacha', text: "ã¾ãšã¯ã€Œã‚¬ãƒãƒ£ã€ï¼\nãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã§è²¯ã‚ãŸã‚³ã‚¤ãƒ³ã‚„ãƒã‚±ãƒƒãƒˆã‚’ä½¿ã£ã¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã‚²ãƒƒãƒˆï¼" },
            { targetId: 'tutorial-char-display', text: "ã‚²ãƒƒãƒˆã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã§ã€ã‚­ãƒ£ãƒ©ã‚’ç€ã›æ›¿ãˆãŸã‚ŠèƒŒæ™¯ã‚’å¤‰ãˆãŸã‚Šã§ãã‚‹ã‚ˆã€‚\nãƒ¬ãƒ™ãƒ«ãŒä¸ŠãŒã‚‹ã¨ã‚­ãƒ£ãƒ©ãŒé€²åŒ–ã™ã‚‹ã“ã¨ã‚‚â€¦ï¼ï¼Ÿ" },
            { targetId: 'tutorial-title-btn', text: "ã€Œç§°å·ã€ã‚‚å¤§äº‹ãªã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è¦ç´ ã€‚\næ¡ä»¶ã‚’é”æˆã—ã¦ã€ãƒ¬ã‚¢ãªç§°å·ã‚’ã‚»ãƒƒãƒˆã—ã‚ˆã†ï¼" },
            { targetId: 'nav-char', text: "ã€Œã‚­ãƒ£ãƒ©ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§ã¯ã€å›³é‘‘ã‚’è¦‹ãŸã‚Šã€\næ‰€æŒã—ã¦ã„ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã®ç¢ºèªãŒã§ãã‚‹ã‚ˆã€‚" },
            { text: "è‡ªåˆ†ã ã‘ã®æœ€å¼·ã§ã‚«ãƒ¯ã‚¤ã‚¤ç›¸æ£’ã«è‚²ã¦ä¸Šã’ã‚ˆã†ï¼" }
        ],
        'social': [
            { text: "ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã®äº¤æµã‚„ã€AIæ©Ÿèƒ½ã«ã¤ã„ã¦èª¬æ˜ã™ã‚‹ã‚ˆï¼" },
            { targetId: 'tutorial-friends-btn', text: "ã€Œãƒ•ãƒ¬ãƒ³ãƒ‰ã€ã§ã¯å‹é”ã‚’æ¤œç´¢ã—ã¦ãƒ•ã‚©ãƒ­ãƒ¼ã§ãã‚‹ã‚ˆã€‚\nãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ç«¶ã„åˆã†ã¨ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³UPï¼" },
            { targetId: 'nav-community', text: "ã€Œæ²ç¤ºæ¿ã€ã¯ã¿ã‚“ãªã®åºƒå ´ã€‚\nè³ªå•ã—ãŸã‚Šã€æˆæœã‚’å ±å‘Šã—åˆã£ãŸã‚Šã—ã¦æ¥½ã—ã‚‚ã†ï¼" },
            { targetId: 'tutorial-ai-btn', text: "æ‚©ã¿äº‹ãŒã‚ã‚Œã°ã€ŒAIãƒãƒ£ãƒƒãƒˆã€ã¸ã€‚\nãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ç›¸è«‡ã‹ã‚‰é›‘è«‡ã¾ã§ä½•ã§ã‚‚OKï¼" },
            { targetId: 'tutorial-muscles-btn', text: "ã€Œç­‹è‚‰ã€ã‚¿ãƒ–ã§ã¯ã€Œãƒãƒƒã‚¹ãƒ«ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã€ãŒè¦‹ã‚‰ã‚Œã‚‹ã‚ˆã€‚\né›ãˆãŸéƒ¨ä½ãŒå…‰ã‚‹ã‹ã‚‰ã€å…¨èº«ã‚³ãƒ³ãƒ—ãƒªãƒ¼ãƒˆã‚’ç›®æŒ‡ãã†ï¼" },
            { targetId: 'nav-settings', text: "é€šçŸ¥è¨­å®šã‚„ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†ã¯ã€Œè¨­å®šã€ã‹ã‚‰ã€‚\næ©Ÿç¨®å¤‰æ›´æ™‚ã®å¼•ãç¶™ãè¨­å®šã‚‚å¿˜ã‚Œãšã«ã­ï¼" }
        ]
    };
    
    let currentRpgStep = 0;
    let typeWriterInterval;
    let updateLoopId; 
    let currentScenarioKey = 'all'; 
    const STORAGE_KEY_RPG = 'fitworks_rpg_tutorial_v16'; 

    document.addEventListener('DOMContentLoaded', function() {
        if (!localStorage.getItem(STORAGE_KEY_RPG)) { setTimeout(() => startRpgTutorial('all'), 800); }
        window.addEventListener('resize', updateSpotlightPosition);
        window.addEventListener('scroll', updateSpotlightPosition);
    });

    function startRpgTutorial(scenarioKey = 'all') {
        currentScenarioKey = scenarioKey;
        if (!scenarios[currentScenarioKey]) return;
        
        currentRpgStep = 0;
        document.getElementById('tutorial-spotlight').classList.add('active');
        document.getElementById('tutorial-rpg-box').classList.add('active');
        document.getElementById('tutorial-backdrop').classList.add('active');
        updateRpgView();
        startUpdateLoop();
    }

    function updateRpgView() {
        const step = scenarios[currentScenarioKey][currentRpgStep];
        
        if (step.preAction && typeof step.preAction === 'function') {
            step.preAction();
        }

        const textBox = document.getElementById('rpg-text');
        const charImg = document.getElementById('rpg-char-img');
        const nextBtn = document.getElementById('rpg-next-btn');
        textBox.innerHTML = '';
        if (typeWriterInterval) clearInterval(typeWriterInterval);
        charImg.classList.add('talking');
        let i = 0;
        const chars = [...step.text]; 
        typeWriterInterval = setInterval(() => {
            if (i < chars.length) { textBox.innerHTML += (chars[i] === '\n') ? '<br>' : chars[i]; i++; } 
            else { clearInterval(typeWriterInterval); charImg.classList.remove('talking'); }
        }, 40);
        
        nextBtn.innerHTML = (currentRpgStep === scenarios[currentScenarioKey].length - 1) ? 'å®Œäº†' : 'æ¬¡ã¸';
        moveSpotlight(step.targetId);
    }

    function startUpdateLoop() {
        if (updateLoopId) cancelAnimationFrame(updateLoopId);
        const loop = () => { updateSpotlightPosition(); updateLoopId = requestAnimationFrame(loop); };
        loop();
    }
    function stopUpdateLoop() { if (updateLoopId) cancelAnimationFrame(updateLoopId); }

    function moveSpotlight(targetId) {
        const spotlight = document.getElementById('tutorial-spotlight');
        const pointer = document.getElementById('tutorial-pointer');
        let targetEl = null;
        if (targetId) {
            targetEl = document.getElementById(targetId);
        }
        if (!targetId || !targetEl) {
            pointer.style.display = 'none';
            spotlight.style.width = '0'; spotlight.style.height = '0';
            spotlight.style.top = (window.pageYOffset + window.innerHeight/2) + 'px';
            spotlight.style.left = (window.pageXOffset + window.innerWidth/2) + 'px';
            const msgBox = document.getElementById('tutorial-rpg-box');
            msgBox.style.top = (window.pageYOffset + window.innerHeight/2 - msgBox.offsetHeight/2) + 'px';
            msgBox.style.left = (window.pageXOffset + window.innerWidth/2) + 'px';
        } else {
            pointer.style.display = 'block';
            targetEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
    }
    
    function updateSpotlightPosition() {
        const step = scenarios[currentScenarioKey][currentRpgStep];
        const msgBox = document.getElementById('tutorial-rpg-box');
        if (!step || !step.targetId) {
             const scrollY = window.pageYOffset; 
             const scrollX = window.pageXOffset;
             msgBox.style.top = (scrollY + window.innerHeight/2 - msgBox.offsetHeight/2) + 'px';
             msgBox.style.left = (scrollX + window.innerWidth/2) + 'px';
             return;
        }
        const targetEl = document.getElementById(step.targetId);
        if(!targetEl) return;
        
        if (targetEl.offsetParent === null && !step.targetId.startsWith('nav-')) return;

        const rect = targetEl.getBoundingClientRect();
        const scrollY = window.pageYOffset; const scrollX = window.pageXOffset;
        const spotlight = document.getElementById('tutorial-spotlight');
        const pointer = document.getElementById('tutorial-pointer');
        spotlight.style.width = (rect.width + 20) + 'px';
        spotlight.style.height = (rect.height + 20) + 'px';
        spotlight.style.top = (rect.top + scrollY - 10) + 'px';
        spotlight.style.left = (rect.left + scrollX - 10) + 'px';
        pointer.style.top = (rect.bottom + scrollY + 10) + 'px';
        pointer.style.left = (rect.left + scrollX + rect.width/2 - 20) + 'px';
        
        let boxTop = rect.top + scrollY - msgBox.offsetHeight - 20;
        
        const forceBelowIds = ['help-btn', 'tutorial-xp-area', 'tutorial-mission-btn', 'tutorial-title-display', 'real-time-clock'];
        const isForceBelow = forceBelowIds.includes(step.targetId) || (rect.top < 120);

        if (isForceBelow) {
             boxTop = rect.bottom + scrollY + 30;
        }
        
        msgBox.style.top = boxTop + 'px';
        msgBox.style.left = (rect.left + scrollX + rect.width/2) + 'px';
    }

    function nextRpgStep() {
        if (currentRpgStep < scenarios[currentScenarioKey].length - 1) { 
            currentRpgStep++; 
            updateRpgView(); 
        } else { 
            endRpgTutorial(); 
        }
    }

    function endRpgTutorial() {
        closeRecordMenu();
        
        document.getElementById('tutorial-rpg-box').classList.remove('active');
        document.getElementById('tutorial-spotlight').classList.remove('active');
        document.getElementById('tutorial-backdrop').classList.remove('active');
        document.getElementById('tutorial-pointer').style.display = 'none';
        stopUpdateLoop();
        localStorage.setItem(STORAGE_KEY_RPG, 'true');
    }

    document.addEventListener('mousemove', (e) => {
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        document.body.style.setProperty('--mouse-x', x);
        document.body.style.setProperty('--mouse-y', y);
    });
</script>
</body>
</html>