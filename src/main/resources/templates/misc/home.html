<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title>ãƒ›ãƒ¼ãƒ  | FitWorks</title>
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <link rel="stylesheet" th:href="@{/css/home.css}">
    <style>
        /* æ–°è¦è¿½åŠ : ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¨ãƒœã‚¿ãƒ³ã‚’é…ç½®ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .character-flex-container {
            display: flex;
            justify-content: center;
            align-items: flex-end; /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã‚’ä¸‹ã«æƒãˆã‚‹ */
            position: relative;
            width: 100%;
            margin-bottom: 20px;
        }
        /* æ–°è¦è¿½åŠ : ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç€ã›æ›¿ãˆãƒœã‚¿ãƒ³ã®ä½ç½® */
        .customize-button-area {
            position: absolute; /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã‚¨ãƒªã‚¢ã‚’åŸºæº–ã«é…ç½® */
            top: 10px;
            right: 10px;
            z-index: 10;
        }
        .customize-button-area .btn {
            background-color: #ffb300; /* ç›®ç«‹ã¤è‰² */
            color: white;
            padding: 8px 15px;
            font-weight: bold;
            text-decoration: none;
            border-radius: 5px;
        }
        /* æ–°è¦è¿½åŠ : é£Ÿäº‹è¨˜éŒ²ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .bottom-action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding-bottom: 50px; /* ãƒ•ãƒƒã‚¿ãƒ¼ã¨ã®é–“éš” */
        }
        .bottom-action-buttons .btn-meal {
            background-color: #4CAF50; /* ç·‘ç³» */
            color: white;
        }
        .bottom-action-buttons .btn {
            padding: 15px 25px;
            font-size: 1.1em;
            text-align: center;
            flex-grow: 1;
        }
        /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç”»åƒã®ã‚³ãƒ³ãƒ†ãƒŠã¨èƒŒæ™¯ */
        .character-container {
            position: relative;
            width: 300px; /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æœ€å¤§å¹…ã«åˆã‚ã›ã¦èª¿æ•´ */
            height: 300px; /* ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®æœ€å¤§é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´ */
            overflow: hidden;
            background-size: cover;
            background-position: center;
        }
        .character-background {
             position: absolute;
             width: 100%;
             height: 100%;
             background-size: cover;
             background-position: center;
        }
        .character-costume-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            object-fit: contain;
        }
    </style>
</head>
<body>
    <div th:insert="~{fragments/header :: header}"></div>

    <main class="main-content">

        <div class="user-info-bar">
            <div class="level-info">
                <span th:text="'Lv.' + ${user.level}">Lv.1</span>
                <div class="xp-bar-container">
                    <div class="xp-bar" th:style="'width: ' + ${user.progressPercent} + '%;'"></div>
                </div>
            </div>
            <p th:text="${user.username}"></p>
        </div>
        
        <div class="character-flex-container">
            <div class="character-container" 
                 th:style="${user.equippedBackgroundItem != null} ? 'background-image: url(' + ${user.equippedBackgroundItem.imagePath} + ');' : 'background-color: #e0f7fa;'">
                
                <img th:src="@{/img/mizu1.png}" alt="ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼" style="width: 100%; height: auto; position: absolute; bottom: 0;">
                
                <img th:if="${user.equippedCostumeItem != null}" 
                     th:src="${user.equippedCostumeItem.imagePath}" 
                     alt="ã‚³ã‚¹ãƒãƒ¥ãƒ¼ãƒ " 
                     class="character-costume-overlay">
            </div>

            <div class="customize-button-area">
                <a th:href="@{/gacha/customize}" class="btn">ğŸ‘— ç€ã›æ›¿ãˆ</a>
            </div>
        </div>

        <div class="home-section">
            <h2>âœ¨ãƒ‡ã‚¤ãƒªãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³</h2>
            <p th:if="${missionStatus.isCompletedToday and !user.isRewardClaimedToday}" style="color: green; font-weight: bold;">ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³é”æˆï¼å ±é…¬ã‚’å—ã‘å–ã‚Šã¾ã—ã‚‡ã†ï¼</p>
            <p th:unless="${missionStatus.isCompletedToday}" th:text="'ä»Šæ—¥ã®ãƒŸãƒƒã‚·ãƒ§ãƒ³: ' + ${missionStatus.missionText}">ãƒŸãƒƒã‚·ãƒ§ãƒ³å†…å®¹</p>
            <a th:href="@{/mission/daily}" class="link-button">è©³ç´°ã‚’è¦‹ã‚‹ &gt;</a>
        </div>

        <div class="home-section">
            <h2>ğŸ’¡ AIã‚³ãƒ¼ãƒã‹ã‚‰ã®ææ¡ˆ</h2>
            <div class="ai-suggestion-card">
                <p th:text="${aiSuggestion.suggestion}">ä»Šæ—¥ã®æœ€é©ãªãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹</p>
                <a th:href="@{/ai-coach/chat}" class="link-button">ãƒãƒ£ãƒƒãƒˆã§ç›¸è«‡ &gt;</a>
            </div>
        </div>
        
        <div class="bottom-action-buttons">
            <a th:href="@{/log/training}" class="btn btn-primary">ğŸƒ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</a>
            <a th:href="@{/log/meal/form}" class="btn btn-meal">ğŸ½ï¸ é£Ÿäº‹è¨˜éŒ²</a>
        </div>

    </main>

    <div th:insert="~{fragments/footer :: footer}"></div>
</body>
</html>