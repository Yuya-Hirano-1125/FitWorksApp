<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>投稿詳細 | FitWorks</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <link rel="stylesheet" th:href="@{/css/base.css}">
    <script th:src="@{/js/theme.js}"></script>

    <style>
        /* --- 詳細ページ固有のスタイル --- */
        
        /* 入力欄が被らないように下の余白を多めに確保 */
        body { 
            padding-bottom: 120px; 
        }

        /* 投稿詳細エリア */
        .post-detail-area {
            text-align: left;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px dashed var(--secondary-color);
            width: 100%;
            overflow-wrap: break-word; /* 長文折り返し対策 */
        }

        .post-title {
            color: var(--primary-color);
            font-size: 1.8rem;
            font-weight: 900;
            margin-bottom: 15px;
            line-height: 1.3;
            word-break: break-word;
        }

        .post-meta {
            color: #888;
            font-size: 0.9rem;
            margin-bottom: 25px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        .post-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .post-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: var(--dark-text);
            white-space: pre-wrap; /* 改行を反映 */
            word-break: break-word;
        }

        /* コメントセクション */
        .comments-section {
            text-align: left;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .comments-header {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--dark-text);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .comment-item {
            background: var(--ai-bubble);
            padding: 15px 20px;
            border-radius: 20px;
            border-bottom-left-radius: 5px;
            margin-bottom: 15px;
            overflow-wrap: break-word;
        }

        .comment-meta {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 8px;
            font-weight: 700;
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            padding-bottom: 5px;
        }
        .comment-author { color: var(--primary-color); }
        .comment-body { 
            font-size: 1rem; 
            line-height: 1.5; 
            color: var(--dark-text);
            white-space: pre-wrap; 
            word-break: break-word;
        }
        .no-comments { text-align: center; color: #999; padding: 20px; font-style: italic; }

        /* 固定コメントフォーム */
        .fixed-comment-form {
            position: fixed !important;
            bottom: 0 !important;
            left: 0;
            width: 100%;
            z-index: 9999;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: center;
            border-top: 1px solid rgba(0,0,0,0.05);
            padding: 15px 20px;
            padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }

        .form-inner {
            max-width: 700px;
            width: 100%;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .input-comment {
            flex-grow: 1;
            padding: 12px 20px;
            border-radius: 30px;
            border: 2px solid var(--secondary-color);
            background: #fff;
            font-size: 1rem;
            outline: none;
            transition: all 0.3s;
        }
        .input-comment:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(255, 105, 180, 0.2);
        }

        .btn-send {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0 25px;
            height: 46px;
            border-radius: 30px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
            box-shadow: 0 4px 10px rgba(255, 105, 180, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-send:hover {
            background: var(--secondary-color);
            transform: scale(1.05);
        }
        .btn-send i { margin-right: 5px; }

        /* ★ いいねボタンのスタイル */
        .like-form { display: inline-block; }
        .btn-like {
            background: none; border: none; cursor: pointer;
            font-size: 1.5rem; color: #ccc; /* デフォルトはグレー */
            transition: all 0.3s; padding: 5px 10px;
            display: flex; align-items: center; gap: 5px;
        }
        .btn-like:hover { transform: scale(1.1); }
        
        /* いいね済みの場合の色（赤ピンク） */
        .btn-like.liked { color: #ff4757; }
        
        .like-text { font-size: 1rem; font-weight: bold; }

    </style>
</head>
<body>

    <div class="main-container">
        
        <div class="header-section" style="margin-bottom: 20px;">
             <h1><i class="fa-solid fa-file-lines header-icon"></i> 投稿詳細</h1>
        </div>

        <div class="post-detail-area">
             <div class="post-title" th:text="${post.title}">タイトル</div>
             <div class="post-meta">
                 <span><i class="fa-solid fa-user"></i> <span th:text="${post.author.username}">ユーザー名</span></span>
                 <span><i class="fa-regular fa-clock"></i> <span th:text="${#temporals.format(post.createdAt, 'yyyy/MM/dd HH:mm')}">日時</span></span>
             </div>
             <div class="post-content" th:text="${post.content}">本文</div>

             <div style="margin-top: 25px; text-align: right; border-top: 1px solid #f0f0f0; padding-top: 15px;">
                 <form th:action="@{/community/{id}/like(id=${post.id})}" method="post" class="like-form">
                     <button type="submit" class="btn-like" 
                             th:classappend="${post.isLikedBy(currentUser)} ? 'liked' : ''">
                         <i th:class="${post.isLikedBy(currentUser)} ? 'fa-solid fa-heart' : 'fa-regular fa-heart'"></i>
                         <span class="like-text" th:text="${post.likedBy.size()} + ' いいね'">0 いいね</span>
                     </button>
                 </form>
             </div>
        </div>

        <div class="comments-section">
             <div class="comments-header">
                 <i class="fa-regular fa-comments"></i> 
                 コメント (<span th:text="${post.comments.size()}">0</span>)
             </div>
             
             <div th:if="${post.comments.empty}" class="no-comments">
                 <i class="fa-solid fa-wind"></i> まだコメントはありません。
             </div>

             <div th:each="comment : ${post.comments}" class="comment-item">
                <div class="comment-meta">
                    <span class="comment-author" th:text="${comment.author.username}">名前</span>
                    <span th:text="${#temporals.format(comment.createdAt, 'MM/dd HH:mm')}">日時</span>
                </div>
                <div class="comment-body" th:text="${comment.content}">コメント内容</div>
             </div>
        </div>

        <div class="button-container">
             <a th:href="@{/community}" class="button secondary">
                 <i class="fa-solid fa-arrow-left"></i> 一覧に戻る
             </a>
        </div>

    </div> 
    
    <div class="fixed-comment-form">
        <form th:action="@{/community/{id}/comment(id=${post.id})}" method="post" class="form-inner">
            <input type="text" name="content" class="input-comment" placeholder="コメントを入力して応援しよう..." required autocomplete="off">
            <button type="submit" class="btn-send">
                <i class="fa-solid fa-paper-plane"></i> 送信
            </button>
        </form>
    </div>

</body>
</html>